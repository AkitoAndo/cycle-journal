# F2. 感情分析

## 概要

ユーザーのジャーナルや発言から感情を検出・分類する機能。感情を可視化し、価値観（根）や環境・記憶（土）との結びつきを理解しやすくする。

---

## 機能構成

```
┌─────────────────────────────────────────────────┐
│              F2. 感情分析                        │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌────────────────────────────────────────┐    │
│  │          入力テキスト解析               │    │
│  │    ジャーナル・発言から感情語を抽出      │    │
│  └────────────────┬───────────────────────┘    │
│                   │                             │
│                   ▼                             │
│  ┌────────────────────────────────────────┐    │
│  │        感情ラベル辞書（B-01）            │    │
│  │    一次感情 → 二次感情へのマッピング     │    │
│  └────────────────┬───────────────────────┘    │
│                   │                             │
│                   ▼                             │
│  ┌────────────────────────────────────────┐    │
│  │          強度スコアリング               │    │
│  │       弱・中・強の3段階で評価           │    │
│  └────────────────┬───────────────────────┘    │
│                   │                             │
│                   ▼                             │
│  ┌────────────────────────────────────────┐    │
│  │          問いかけ生成                   │    │
│  │    感情に応じた問いを選択・生成          │    │
│  └────────────────────────────────────────┘    │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## 感情カテゴリ体系

### 一次感情（6カテゴリ）

| カテゴリ | 説明 | 問いかけ例 |
|---------|------|-----------|
| 喜び | 望みや期待が満たされている | 「その喜びの背景には、どんなことがあった？」 |
| 怒り | 不正・不公平・期待外れへの反応 | 「その怒りは、どんな大切なものを守ろうとしている？」 |
| 哀しみ | 喪失や満たされなさへの気づき | 「その哀しみから、何に気づいた？」 |
| 不安 | 未来への不確かさ・リスク感 | 「その不安は、どんな未来を想像させている？」 |
| 驚き | 予期しない出来事・気づき | 「その驚きは、どんな意味を持ちそう？」 |
| 安らぎ | 安全で守られている感覚 | 「その安らぎを、これからどう生かせそう？」 |

### 二次感情（各カテゴリの派生）

| 一次感情 | 二次感情例 |
|---------|-----------|
| 喜び | 安心、満足、達成感、誇り、愛情 |
| 怒り | いら立ち、憤り、嫌悪、失望 |
| 哀しみ | 喪失感、孤独、寂しさ、後悔 |
| 不安 | 恐れ、緊張、心配、焦り |
| 驚き | 好奇心、動揺、感嘆、違和感 |
| 安らぎ | 落ち着き、平穏、信頼、調和 |

---

## 処理フロー

### 1. 感情語抽出

入力テキストから感情を表す語句を抽出する。

### 2. ラベリング

抽出した語句を一次・二次感情カテゴリにマッピングする。

### 3. 強度評価

感情の強さを3段階（弱・中・強）でスコアリングする。

### 4. 複合感情の処理

複数の感情が同時に存在する場合は併記する。

---

## 入出力仕様

### 入力

```json
{
  "text": "今日は少し不安だけど、同時にワクワクもしている",
  "context": {
    "previous_emotions": ["安心"]
  }
}
```

### 出力

```json
{
  "emotions": [
    {
      "primary": "不安",
      "secondary": "心配",
      "intensity": "弱",
      "evidence": ["不安"]
    },
    {
      "primary": "喜び",
      "secondary": "期待",
      "intensity": "中",
      "evidence": ["ワクワク"]
    }
  ],
  "suggested_prompts": [
    "その不安は、どんな未来を想像させている？",
    "ワクワクの中には、どんな期待がある？"
  ],
  "cycle_focus": "根（感情の源を探る）"
}
```

---

## 実装ルール

| ルール | 説明 |
|--------|------|
| 否定しない | 感情は良し悪しで判断せず、そのまま受けとめる |
| 複数併記 | 一つの発話に複数感情が含まれる場合は全て記録 |
| 推定ラベル | 明確でない場合は「推定」として扱う |
| トーン調整連携 | 感情強度に応じてF1のトーン制御に反映 |

---

## Cycleモデルとの対応

| Cycle要素 | 感情分析での役割 |
|----------|-----------------|
| 土（Soil） | 感情が生まれた背景・環境を探る |
| 根（Root） | 感情の源・価値観との結びつきを明らかにする |
| 水（Water） | 感情の時系列変化を追跡する |

---

## 関連ドキュメント

- B-01: 感情ラベル辞書
- F1: 会話エンジン（トーン調整との連携）
- F5: 状態判定（感情から状態を推定）
