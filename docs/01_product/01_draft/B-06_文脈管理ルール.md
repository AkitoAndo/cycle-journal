# B-06: 文脈管理のルール

## 概要

ユーザーとの対話の中で「いま何について話しているか」を正しく把握し続けるための設計。ユーザーの安心感を守り、自然な流れで内省や行動提案を行う。

文脈は「**幹**」のように会話全体を支え、必要に応じて「**枝**」のように広がりをもたせる。

---

## 文脈管理の4原則

### 1. 現在の焦点を明示する

- 対話の流れの中で、いま扱っているテーマ（土・根・幹・枝・葉・実・水・空のどこか）を意識する
- **例**: 「いまは根っこの部分（価値観）を一緒に見ているね。」

### 2. 過去の参照は短く要約して提示

- B-05のデータを活用し、必要に応じて簡潔に振り返る
- **例**: 「前に"自由を大事にしたい"と言っていたけど、今も同じ想いがあるかな？」

### 3. 未来方向を残す

- 空（Sky）の視点を意識し、次にどんな問いや行動につながるかを予告的に示す
- **例**: 「この気づきをどう活かすか、次の一歩を一緒に見つけよう。」

### 4. 余白を尊重する

- 文脈が曖昧な場合は無理に推測せず、ユーザーに委ねる
- **例**: 「この話は続けたい？ それとも別のことに移ろうか？」

---

## 実装ルール

- 対話の各ターンごとに「現在の焦点タグ」を保持（例: `Root/Value`, `Leaf/Action` など）
- 焦点が変化する際は、前回のタグを閉じ、新しいタグを開始する
- 長いセッションでは3〜5ターンごとに要約を入れる
- 文脈情報はユーザーごとに履歴を蓄積（B-05と連携）

---

## 実装フォーマット例（JSON案）

```json
{
  "session_id": "abc123",
  "turn": 12,
  "focus": "Root",
  "summary": "価値観として自由を重視している話題",
  "next_hint": "自由を活かす行動提案につなげる"
}
```

---

## Cycleモデルとの対応

| Cycle要素 | 文脈管理での役割 |
|----------|-----------------|
| 幹（Trunk） | 文脈そのもの。会話の軸として全体を支える |
| 枝（Branch） | 思考や話題の広がり。文脈を分岐させ、整理する |
| 土（Soil） | 過去の記憶や環境。B-05の履歴参照に相当 |
| 空（Sky） | 未来方向や気づき。次のステップを示唆する |

---

## まとめ

B-06は文脈を「幹」として管理しつつ、土（過去）を参照し、枝（思考の広がり）に展開し、空（未来）に開く流れを設計する。これにより、Cycleのコーチは会話の一貫性と自然な成長の流れを保つ。
