# CycleJournal iOS アプリ - 実装済み機能一覧

## 概要
mobileディレクトリに実装されているSwiftUI iOSアプリの機能をユーザーストーリー形式でまとめる。

---

## 1. 日記エントリ管理

### US-001: 日記の作成
**ユーザーとして**、チャット形式で日記を入力したい。
**理由**: 手軽にその日の出来事や気持ちを記録するため。

**実装内容**:
- チャット風の入力フィールドで日記を作成
- 送信ボタンで即座に保存
- 複数行入力対応（1〜5行まで自動拡張）

**関連ファイル**: `DiaryListView.swift:273-282`

---

### US-002: 日記の編集
**ユーザーとして**、過去の日記を編集したい。
**理由**: 誤字の修正や内容の追記を行うため。

**実装内容**:
- メッセージバブルをタップして編集モードに入る
- 編集中はバブルがオレンジ色に変化
- 「編集済み」ラベルが表示される
- キャンセル機能あり

**関連ファイル**: `DiaryListView.swift:284-311`, `DiaryRowView`

---

### US-003: 日記の削除
**ユーザーとして**、不要な日記を削除したい。
**理由**: プライバシーや整理のため。

**実装内容**:
- スワイプで削除
- 確認なしで即削除

**関連ファイル**: `DiaryListView.swift:264-271`

---

## 2. タグ機能

### US-004: タグの作成
**ユーザーとして**、新しいタグを作成したい。
**理由**: 日記を分類・整理するため。

**実装内容**:
- タグ管理画面で新規タグを作成
- 重複チェックあり
- 空白のみのタグは作成不可

**関連ファイル**: `TagManagementView.swift:109-115`, `DiaryStore.swift:125-132`

---

### US-005: タグの編集・リネーム
**ユーザーとして**、既存のタグ名を変更したい。
**理由**: より適切な名前に修正するため。

**実装内容**:
- タグ管理画面でインライン編集
- 関連する全日記のタグも自動更新
- 重複チェックあり

**関連ファイル**: `TagManagementView.swift:117-136`, `DiaryStore.swift:134-156`

---

### US-006: タグの削除
**ユーザーとして**、不要なタグを削除したい。
**理由**: タグリストを整理するため。

**実装内容**:
- 削除確認ダイアログ表示
- 関連する全日記からタグを自動削除
- 使用件数を表示

**関連ファイル**: `TagManagementView.swift:139-146`, `DiaryStore.swift:158-172`

---

### US-007: 日記へのタグ付け
**ユーザーとして**、日記にタグを付けたい。
**理由**: 後から検索・フィルタリングしやすくするため。

**実装内容**:
- 入力時にタグボタンからタグ選択シートを表示
- 複数タグ選択可能
- 選択中のタグは入力欄下部に表示
- 日記バブル内にタグを表示（最大3つ + 残数表示）

**関連ファイル**: `DiaryListView.swift:131-139`, `TagSelectionSheetView`

---

## 3. 検索・フィルタリング

### US-008: キーワード検索
**ユーザーとして**、日記をキーワードで検索したい。
**理由**: 特定の内容を素早く見つけるため。

**実装内容**:
- 検索画面でキーワード入力
- 日記本文・タグ両方を検索対象
- 大文字小文字を区別しない
- 検索結果件数を表示

**関連ファイル**: `SearchView`, `DiaryStore.swift:88-94`

---

### US-009: タグフィルタリング
**ユーザーとして**、特定のタグで日記を絞り込みたい。
**理由**: カテゴリ別に日記を閲覧するため。

**実装内容**:
- 検索画面でタグをタップして選択
- 複数タグ選択可能（OR条件）
- 選択中のタグをチップで表示
- フィルタクリア機能

**関連ファイル**: `SearchView`, `DiaryStore.swift:80-85`

---

### US-010: 日付フィルタリング
**ユーザーとして**、特定の日付の日記だけを見たい。
**理由**: その日に何を書いたか確認するため。

**実装内容**:
- 週間カレンダーまたは月間カレンダーから日付選択
- 選択した日付はナビバーに表示
- フィルタクリア機能

**関連ファイル**: `DiaryStore.swift:73-78`

---

## 4. カレンダー表示

### US-011: 週間カレンダー表示
**ユーザーとして**、週単位で日記の有無を確認したい。
**理由**: 最近の記録状況を把握するため。

**実装内容**:
- 横スクロール式の週間カレンダー
- 前後52週分表示可能
- 日記がある日はオレンジのドット表示
- 今日は青色でハイライト
- 選択した日付は青い円で表示

**関連ファイル**: `WeeklyCalendarView.swift`

---

### US-012: 月間カレンダー表示
**ユーザーとして**、月単位で日記の有無を確認したい。
**理由**: 長期間の記録状況を俯瞰するため。

**実装内容**:
- 月間カレンダーをモーダル表示
- 月の切り替え機能
- 日記がある日はオレンジのドット表示
- 選択した日付の日記件数を表示
- 「今日」ボタンで今日に戻る

**関連ファイル**: `CalendarView.swift`

---

## 5. データ永続化

### US-013: データの自動保存
**ユーザーとして**、日記が自動的に保存されてほしい。
**理由**: データ消失を防ぐため。

**実装内容**:
- UserDefaultsによるローカル保存
- 日記とタグを別々に保存
- JSON形式でエンコード/デコード
- アプリ起動時に自動読み込み

**関連ファイル**: `DiaryStore.swift:19-43`

---

## 6. UI/UX

### US-014: チャット風UI
**ユーザーとして**、メッセージアプリのような使い心地で日記を書きたい。
**理由**: 慣れ親しんだUIで気軽に記録するため。

**実装内容**:
- 右寄せのメッセージバブル
- 時刻表示
- 自動スクロール（最新メッセージへ）
- キーボード対応

**関連ファイル**: `DiaryListView.swift`, `DiaryRowView`

---

### US-015: フィルタ状態の可視化
**ユーザーとして**、現在適用中のフィルタを確認したい。
**理由**: どの条件で絞り込んでいるか把握するため。

**実装内容**:
- 検索キーワード・タグのフィルタ表示
- ワンタップでフィルタクリア
- タップで検索画面を開く

**関連ファイル**: `DiaryListView.swift:26-69`

---

## データモデル

### DiaryEntry
```swift
struct DiaryEntry: Identifiable, Codable {
    let id: UUID
    var content: String      // 日記本文
    var createdAt: Date      // 作成日時
    var tags: [String]       // 付与されたタグ
    var isEdited: Bool       // 編集済みフラグ
}
```

**関連ファイル**: `DiaryEntry.swift`

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | SwiftUI |
| データ永続化 | UserDefaults |
| アーキテクチャ | MVVM (ObservableObject) |
| 最小iOS | iOS 17+ (onChange修飾子の使用から推測) |
