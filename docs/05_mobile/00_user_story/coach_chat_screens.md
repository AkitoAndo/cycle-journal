# CycleJournal iOS - 内省チャットボット機能 画面ユーザーストーリー

## 概要

01_productで設計されたAIコーチ「Cycle」の機能をiOSアプリに実装するために必要な画面を定義する。

---

## 現在の画面構成

```
現在のアプリ（日記機能のみ）
├── DiaryListView        # 日記一覧（メイン画面）
├── WeeklyCalendarView   # 週間カレンダー
├── CalendarView         # 月間カレンダー（モーダル）
├── SearchView           # 検索（モーダル）
├── TagManagementView    # タグ管理（モーダル）
└── DiaryEditView        # 日記編集（モーダル）
```

---

## 追加が必要な画面構成

```
内省チャットボット機能追加後
├── MainTabView                    # タブナビゲーション（新規）
│   ├── [日記タブ]
│   │   └── DiaryListView          # 既存
│   │
│   ├── [コーチタブ]
│   │   ├── CoachHomeView          # コーチホーム（新規）
│   │   ├── CoachChatView          # コーチとの会話（新規）
│   │   └── SessionHistoryView     # 会話履歴一覧（新規）
│   │
│   ├── [タスクタブ]
│   │   ├── TaskListView           # 行動タスク一覧（新規）
│   │   └── TaskReflectionView     # ふりかえり入力（新規）
│   │
│   └── [設定タブ]
│       └── SettingsView           # 設定画面（新規）
│
└── OnboardingView                 # 初回オンボーディング（新規）
```

---

## 画面別ユーザーストーリー

### 1. ナビゲーション・共通

#### US-C001: タブナビゲーション
**ユーザーとして**、日記・コーチ・タスク・設定を簡単に切り替えたい。
**理由**: 機能ごとに素早くアクセスするため。

**受け入れ条件**:
- 4つのタブ（日記・コーチ・タスク・設定）が画面下部に表示される
- 未読通知がある場合はバッジを表示
- 選択中のタブがハイライトされる

**UI要素**:
| タブ | アイコン | 説明 |
|------|----------|------|
| 日記 | book | 既存の日記機能 |
| コーチ | bubble.left.and.bubble.right | AIコーチとの会話 |
| タスク | checkmark.circle | 行動タスク管理 |
| 設定 | gear | アプリ設定 |

---

### 2. コーチ機能

#### US-C002: コーチホーム画面
**ユーザーとして**、コーチ機能のメイン画面から会話を始めたい。
**理由**: どこから内省を始めればいいか分かりやすくするため。

**受け入れ条件**:
- 「今日の調子はどう？」など会話を始めるボタン
- 最近の会話サマリーを表示
- 進行中のタスクがあればリマインド表示
- 「日記から話す」ボタンで日記を元に会話開始

**UI要素**:
```
┌────────────────────────────────┐
│         Cycle                  │
│      (大樹のイラスト)           │
├────────────────────────────────┤
│  こんにちは。                   │
│  今日はどんな一日だった？        │
│                                │
│  ┌────────────────────────┐   │
│  │   話しかける            │   │
│  └────────────────────────┘   │
│                                │
│  ┌────────────────────────┐   │
│  │   日記から話す          │   │
│  └────────────────────────┘   │
├────────────────────────────────┤
│  最近の会話                     │
│  ・11/28 仕事のストレスについて  │
│  ・11/25 新しい目標について      │
└────────────────────────────────┘
```

---

#### US-C003: コーチとの会話画面
**ユーザーとして**、AIコーチと自然に会話しながら内省したい。
**理由**: 対話を通じて自分の感情や価値観を整理するため。

**受け入れ条件**:
- チャット形式のUI（ユーザー: 右、コーチ: 左）
- コーチの応答中はローディング表示
- 会話履歴をスクロールで確認可能
- 「この会話を終了」ボタン
- 会話から行動タスクを作成できる

**UI要素**:
```
┌────────────────────────────────┐
│ ← Cycle との会話        終了 ✕ │
├────────────────────────────────┤
│                                │
│  ┌──────────────────┐          │
│  │ 今日はどんな気持ち │          │
│  │ で過ごしていた？   │          │
│  └──────────────────┘          │
│           コーチ 10:30         │
│                                │
│         ┌──────────────────┐   │
│         │ 朝は少し不安だった  │   │
│         │ けど、午後は落ち着い│   │
│         │ てきた             │   │
│         └──────────────────┘   │
│                    あなた 10:32 │
│                                │
│  ┌──────────────────┐          │
│  │ その「不安」の奥に  │          │
│  │ は、どんな思いが    │          │
│  │ あったのかな？      │          │
│  └──────────────────┘          │
│           コーチ 10:33         │
│                                │
├────────────────────────────────┤
│  [メッセージを入力...]    送信  │
└────────────────────────────────┘
```

**関連機能**:
- F1: 会話エンジン
- F2: 感情分析（バックエンド）
- F3: 価値観分析（バックエンド）
- F4: 質問生成
- F5: 状態判定（バックエンド）

---

#### US-C004: 会話からタスク作成
**ユーザーとして**、会話中に気づいた行動をタスクとして保存したい。
**理由**: 内省で得た気づきを具体的な行動につなげるため。

**受け入れ条件**:
- コーチが行動提案をした時に「タスクに追加」ボタン表示
- タップでタスク一覧に追加
- 追加完了のフィードバック

**関連機能**:
- F6: 行動提案

---

#### US-C005: 会話履歴一覧
**ユーザーとして**、過去の会話を振り返りたい。
**理由**: 以前の内省内容を思い出すため。

**受け入れ条件**:
- セッション一覧を日付順に表示
- 各セッションの概要（最初の発言・感情ラベル等）
- タップで会話詳細を表示（読み取り専用）
- セッションの削除機能

**UI要素**:
```
┌────────────────────────────────┐
│ 会話履歴                       │
├────────────────────────────────┤
│ ┌────────────────────────────┐ │
│ │ 11月28日(木)               │ │
│ │ 仕事のストレスについて       │ │
│ │ 😔 不安・心配              │ │
│ └────────────────────────────┘ │
│                                │
│ ┌────────────────────────────┐ │
│ │ 11月25日(月)               │ │
│ │ 新しい目標について          │ │
│ │ 😊 期待・希望              │ │
│ └────────────────────────────┘ │
└────────────────────────────────┘
```

---

#### US-C006: 日記からコーチと会話
**ユーザーとして**、書いた日記の内容についてコーチと話したい。
**理由**: 日記に書いたことを深掘りして内省するため。

**受け入れ条件**:
- 日記詳細画面に「この日記について話す」ボタン
- タップでコーチ会話画面に遷移
- 日記内容がコンテキストとして渡される
- コーチが日記の内容を踏まえて質問

**UI要素（日記画面への追加）**:
```
┌────────────────────────────────┐
│ 日記詳細                       │
├────────────────────────────────┤
│ 11月28日                       │
│                                │
│ 今日は朝から会議が多くて        │
│ 少し疲れた...                  │
│                                │
│ ┌────────────────────────────┐ │
│ │  🌳 この日記について話す    │ │
│ └────────────────────────────┘ │
└────────────────────────────────┘
```

---

### 3. タスク機能

#### US-C007: 行動タスク一覧
**ユーザーとして**、コーチから提案されたタスクを管理したい。
**理由**: やるべき行動を忘れずに実行するため。

**受け入れ条件**:
- 未完了・完了済みタスクをリスト表示
- タスクのステータス（未着手・進行中・完了）
- タスクをタップで詳細表示
- 完了ボタンでふりかえり画面へ

**UI要素**:
```
┌────────────────────────────────┐
│ 行動タスク                     │
├────────────────────────────────┤
│ 未完了                         │
│ ┌────────────────────────────┐ │
│ │ ○ 朝5分の自分時間をとる    │ │
│ │   期限: 11/30              │ │
│ └────────────────────────────┘ │
│ ┌────────────────────────────┐ │
│ │ ○ 感謝を1つ書き出す        │ │
│ │   期限: 毎日               │ │
│ └────────────────────────────┘ │
├────────────────────────────────┤
│ 完了済み                       │
│ ┌────────────────────────────┐ │
│ │ ✓ 深呼吸を3回する          │ │
│ │   完了: 11/27              │ │
│ └────────────────────────────┘ │
└────────────────────────────────┘
```

**関連機能**:
- F6: 行動提案

---

#### US-C008: タスク詳細
**ユーザーとして**、タスクの詳細と背景を確認したい。
**理由**: なぜこのタスクが提案されたか理解するため。

**受け入れ条件**:
- タスク内容の詳細表示
- 関連する会話へのリンク
- 「完了してふりかえる」ボタン
- 「タスクを削除」ボタン

---

#### US-C009: ふりかえり入力
**ユーザーとして**、タスク実行後にふりかえりをしたい。
**理由**: 行動から学びを得て次につなげるため。

**受け入れ条件**:
- ふりかえりの4ステップに沿った入力
  1. 事実の確認「何をした？」
  2. 感情の観察「どう感じた？」
  3. 学びの抽出「何に気づいた？」
  4. 次への調整「次はどうする？」
- 任意で感情アイコン選択
- 保存後、コーチからのフィードバック表示

**UI要素**:
```
┌────────────────────────────────┐
│ ふりかえり                     │
│ 「朝5分の自分時間をとる」       │
├────────────────────────────────┤
│                                │
│ 1. 何をした？                  │
│ ┌────────────────────────────┐ │
│ │ 朝起きてすぐ、窓際で        │ │
│ │ コーヒーを飲んだ            │ │
│ └────────────────────────────┘ │
│                                │
│ 2. どう感じた？                │
│ ┌────────────────────────────┐ │
│ │ 思ったより気持ちが          │ │
│ │ スッキリした                │ │
│ └────────────────────────────┘ │
│                                │
│ 3. 何に気づいた？              │
│ ┌────────────────────────────┐ │
│ │ 朝の静かな時間が自分には    │ │
│ │ 必要だったんだ              │ │
│ └────────────────────────────┘ │
│                                │
│ 4. 次はどうする？              │
│ ┌────────────────────────────┐ │
│ │ 明日も続けてみる            │ │
│ └────────────────────────────┘ │
│                                │
│ ┌────────────────────────────┐ │
│ │      保存する               │ │
│ └────────────────────────────┘ │
└────────────────────────────────┘
```

**関連機能**:
- F7: ふりかえり支援

---

### 4. 設定機能

#### US-C010: 設定画面
**ユーザーとして**、アプリの設定を管理したい。
**理由**: 自分に合った使い方にカスタマイズするため。

**受け入れ条件**:
- アカウント情報（Sign in with Apple連携）
- 通知設定
- データエクスポート
- プライバシーポリシー・利用規約リンク
- ログアウト

**UI要素**:
```
┌────────────────────────────────┐
│ 設定                           │
├────────────────────────────────┤
│ アカウント                      │
│ ┌────────────────────────────┐ │
│ │ 👤 user@example.com        │ │
│ │    Sign in with Apple      │ │
│ └────────────────────────────┘ │
├────────────────────────────────┤
│ 通知                           │
│ ┌────────────────────────────┐ │
│ │ リマインダー通知      [ON] │ │
│ │ タスク期限通知        [ON] │ │
│ └────────────────────────────┘ │
├────────────────────────────────┤
│ データ                         │
│ ┌────────────────────────────┐ │
│ │ データをエクスポート        │ │
│ └────────────────────────────┘ │
├────────────────────────────────┤
│ その他                         │
│ ┌────────────────────────────┐ │
│ │ プライバシーポリシー        │ │
│ │ 利用規約                   │ │
│ │ バージョン: 1.0.0          │ │
│ └────────────────────────────┘ │
├────────────────────────────────┤
│ ┌────────────────────────────┐ │
│ │      ログアウト            │ │
│ └────────────────────────────┘ │
└────────────────────────────────┘
```

---

### 5. オンボーディング

#### US-C011: 初回オンボーディング
**ユーザーとして**、アプリの使い方と目的を理解したい。
**理由**: 内省アプリを効果的に使い始めるため。

**受け入れ条件**:
- 3-4ステップのスライド形式
- Cycleの世界観（大樹の比喩）を紹介
- 主な機能（日記・コーチ・タスク）の説明
- Sign in with Appleでの認証
- スキップ可能（ただし認証は必須）

**UI要素**:
```
[ステップ1]
┌────────────────────────────────┐
│                                │
│      🌳                        │
│    大きな樹のイラスト            │
│                                │
│    CycleJournal へようこそ      │
│                                │
│    あなたの内省を               │
│    静かに見守る大樹として        │
│    寄り添います                 │
│                                │
│         ● ○ ○ ○              │
│                                │
│  ┌────────────────────────┐   │
│  │      次へ               │   │
│  └────────────────────────┘   │
└────────────────────────────────┘

[ステップ4: 認証]
┌────────────────────────────────┐
│                                │
│    始める準備ができました        │
│                                │
│  ┌────────────────────────┐   │
│  │   Sign in with Apple   │   │
│  └────────────────────────┘   │
│                                │
└────────────────────────────────┘
```

---

## 画面遷移図

```
                    ┌─────────────────┐
                    │ OnboardingView  │
                    │ (初回のみ)       │
                    └────────┬────────┘
                             │
                             ▼
┌────────────────────────────────────────────────────────────────┐
│                        MainTabView                              │
├────────────────┬─────────────────┬────────────────┬────────────┤
│   日記タブ      │   コーチタブ     │   タスクタブ    │  設定タブ   │
│                │                 │                │            │
│ DiaryListView  │ CoachHomeView   │ TaskListView   │SettingsView│
│      │         │      │          │      │         │            │
│      ▼         │      ▼          │      ▼         │            │
│ DiaryRowView   │ CoachChatView   │ TaskDetailView │            │
│ (タップで編集)  │      │          │      │         │            │
│      │         │      ▼          │      ▼         │            │
│      ▼         │ SessionHistory  │TaskReflection  │            │
│ 「この日記に    │     View        │    View        │            │
│  ついて話す」   │                 │                │            │
│      │         │                 │                │            │
│      └─────────┴─────────────────┘                │            │
│              CoachChatView へ                      │            │
└────────────────────────────────────────────────────────────────┘
```

---

## データフロー

```
┌─────────────────────────────────────────────────────────────┐
│                        iOS App                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  DiaryStore          CoachStore          TaskStore          │
│  (既存)              (新規)              (新規)              │
│     │                   │                   │                │
│     │    ┌──────────────┴───────────────────┘               │
│     │    │                                                   │
│     └────┼───────────────────────────────────────────────────│
│          ▼                                                   │
│     APIClient (新規)                                         │
│          │                                                   │
└──────────┼───────────────────────────────────────────────────┘
           │
           ▼
    API Gateway → Lambda → Bedrock
```

---

## 優先度

| 優先度 | 画面 | 理由 |
|--------|------|------|
| **P0** | MainTabView | ナビゲーションの基盤 |
| **P0** | CoachChatView | コア機能 |
| **P0** | CoachHomeView | コーチ機能の入り口 |
| **P1** | TaskListView | 行動変容に必要 |
| **P1** | TaskReflectionView | 循環を完成させる |
| **P1** | SettingsView | 認証・基本設定 |
| **P2** | SessionHistoryView | 過去の振り返り |
| **P2** | OnboardingView | 初回UX向上 |
| **P2** | TaskDetailView | タスク詳細確認 |
| **P3** | 日記からコーチ連携 | 機能間連携 |

---

## 次のステップ

1. 各画面のワイヤーフレーム詳細化
2. APIエンドポイントとの対応表作成
3. データモデル（Swift構造体）設計
4. プロトタイプ実装
